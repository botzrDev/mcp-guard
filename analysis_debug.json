# Code Analysis Report

**Generated:** 2025-12-25 21:14:12 UTC

## Summary

- **Files Analyzed:** 1
- **Issues Found:** 36
- **Analysis Duration:** 0.06s

---

## Issues by Severity

### ðŸ”´ Critical (1 issues)

#### Long method 'run_cli' detected: 189 lines, 213 statements, complexity 36

- **File:** `src/main.rs`
- **Line:** 216

**Code:**
```
async fn run_cli(cli: Cli) -> anyhow::Result<()> {
    match cli.command {
        Commands::Init { format, force } => {
            // Initialize basic tracing for CLI commands
            let _guard = init_tracing(cli.verbose, None);
...
```

**Recommendation:** Consider breaking down 'run_cli' into smaller, more focused methods. Current metrics: LOC=189, Statements=213, Complexity=36, Nesting=10

---

### ðŸŸ  High (12 issues)

#### Consider extracting the duplicated code into a shared function or module. Type-2 clone with 100.0% similarity.

- **File:** `src/main.rs`
- **Line:** 877

**Code:**
```
    fn test_generate_config_yaml() {
        let config = generate_config("yaml");
        assert!(config.contains("server:"));
        assert!(config.contains("transport:"));
    }
```

---

#### Consider extracting the duplicated code into a shared function or module. Type-2 clone with 97.8% similarity.

- **File:** `src/main.rs`
- **Line:** 569

**Code:**
```
    fn create_test_config_http(url: &str) -> Config {
        let config_str = format!(r#"
[server]
host = "127.0.0.1"
port = 3000

[upstream]
transport = "http"
url = "{}"

[rate_limit]
enabled = false
"#, url);
        let temp_file = NamedTempFile::new().unwrap();
        std::fs::write(temp_file.path(), &config_str).unwrap();
        Config::from_file(&temp_file.path().to_path_buf()).unwrap()
    }
```

---

#### Magic value '"result"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 500

---

#### Magic value '"result"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 502

---

#### Magic value '"serverInfo"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 503

---

#### Magic value '"application/json"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 526

---

#### Magic value '"Accept"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 547

---

#### Magic value '"text/event-stream"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 547

---

#### Magic value '"result"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 711

---

#### Magic value '"POST"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 796

---

#### Magic value '"POST"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 811

---

#### Magic value '"text/event-stream"' passed as function argument (high). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 830

---

### ðŸŸ¡ Medium (5 issues)

#### Consider extracting the duplicated code into a shared function or module. Type-3 clone with 86.6% similarity.

- **File:** `src/main.rs`
- **Line:** 587

**Code:**
```
    fn create_test_config_stdio() -> Config {
        let config_str = r#"
[server]
host = "127.0.0.1"
port = 3000

[upstream]
transport = "stdio"
command = "/bin/echo"
args = []

[rate_limit]
enabled = false
"#;
        let temp_file = NamedTempFile::new().unwrap();
        std::fs::write(temp_file.path(), config_str).unwrap();
        Config::from_file(&temp_file.path().to_path_buf()).unwrap()
    }
```

---

#### Consider extracting the duplicated code into a shared function or module. Type-3 clone with 85.8% similarity.

- **File:** `src/main.rs`
- **Line:** 569

**Code:**
```
    fn create_test_config_http(url: &str) -> Config {
        let config_str = format!(r#"
[server]
host = "127.0.0.1"
port = 3000

[upstream]
transport = "http"
url = "{}"

[rate_limit]
enabled = false
"#, url);
        let temp_file = NamedTempFile::new().unwrap();
        std::fs::write(temp_file.path(), &config_str).unwrap();
        Config::from_file(&temp_file.path().to_path_buf()).unwrap()
    }
```

---

#### Consider extracting the duplicated code into a shared function or module. Type-3 clone with 83.6% similarity.

- **File:** `src/main.rs`
- **Line:** 587

**Code:**
```
    fn create_test_config_stdio() -> Config {
        let config_str = r#"
[server]
host = "127.0.0.1"
port = 3000

[upstream]
transport = "stdio"
command = "/bin/echo"
args = []

[rate_limit]
enabled = false
"#;
        let temp_file = NamedTempFile::new().unwrap();
        std::fs::write(temp_file.path(), config_str).unwrap();
        Config::from_file(&temp_file.path().to_path_buf()).unwrap()
    }
```

---

#### Consider extracting the duplicated code into a shared function or module. Type-3 clone with 83.1% similarity.

- **File:** `src/main.rs`
- **Line:** 569

**Code:**
```
    fn create_test_config_http(url: &str) -> Config {
        let config_str = format!(r#"
[server]
host = "127.0.0.1"
port = 3000

[upstream]
transport = "http"
url = "{}"

[rate_limit]
enabled = false
"#, url);
        let temp_file = NamedTempFile::new().unwrap();
        std::fs::write(temp_file.path(), &config_str).unwrap();
        Config::from_file(&temp_file.path().to_path_buf()).unwrap()
    }
```

---

#### Long method 'bootstrap' detected: 137 lines, 149 statements, complexity 21

- **File:** `src/main.rs`
- **Line:** 30

**Code:**
```
pub async fn bootstrap(config: Config) -> anyhow::Result<BootstrapResult> {
    // Create shutdown token for graceful shutdown coordination
    let shutdown_token = CancellationToken::new();

    // Initialize Prometheus metrics
...
```

**Recommendation:** Consider breaking down 'bootstrap' into smaller, more focused methods. Current metrics: LOC=137, Statements=149, Complexity=21, Nesting=9

---

### âšª Low (18 issues)

#### Magic value '"Features:"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 300

---

#### Magic value '"jsonrpc"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 473

---

#### Magic value '"2.0"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 473

---

#### Magic value '"method"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 475

---

#### Magic value '"initialize"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 475

---

#### Magic value '"params"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 476

---

#### Magic value '"protocolVersion"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 477

---

#### Magic value '"capabilities"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 478

---

#### Magic value '"clientInfo"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 479

---

#### Magic value '"name"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 480

---

#### Magic value '"version"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 481

---

#### Magic value '"name"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 506

---

#### Magic value '"unknown"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 506

---

#### Magic value '"version"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 507

---

#### Magic value '"unknown"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 507

---

#### Magic value '"unknown"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 556

---

#### Magic value '"server:"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 879

---

#### Magic value '"transport:"' found in code (low). Consider extracting this magic string into a named constant to improve maintainability.

- **File:** `src/main.rs`
- **Line:** 880

---

